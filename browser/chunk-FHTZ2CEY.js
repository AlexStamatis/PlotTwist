import{a as q}from"./chunk-GV5T73XR.js";import{a as Y}from"./chunk-KQ5AQDIS.js";import{Fa as z,Ga as l,Ha as w,Ia as f,L as g,M as _,Oa as W,P as u,S as x,Sa as U,U as D,Ua as L,W as c,Wa as j,Y as O,_ as h,a as T,b as E,bb as $,cb as R,da as y,db as B,fb as H,ga as d,gb as G,ia as N,ib as C,o as A,oa as r,pa as o,qa as b,ra as F,rb as J,sa as V,ua as M,wa as m,xa as p}from"./chunk-BUJXTFFG.js";var P=class s{item;type="favorites";rated=new u;favoriteChanged=new u;watchlistChanged=new u;removed=new u;openRatingModal=new u;get title(){return this.item?.title||this.item?.name||""}get releaseDate(){return this.item?.release_date||this.item?.first_air_date||""}get poster(){return this.item?.poster_path?`https://image.tmdb.org/t/p/w185${this.item.poster_path}`:"https://via.placeholder.com/185x278?text=Image+Unavailable"}get overview(){return this.item?.overview||""}get rating(){return this.item?.rated?.value??null}rate(n){this.item&&this.rated.emit({item:this.item,rating:n})}toggleFavorite(){this.item&&this.favoriteChanged.emit(this.item)}toggleWatchlist(){this.item&&this.watchlistChanged.emit(this.item)}remove(){this.item&&this.removed.emit(this.item)}openRatingModalHandler(){this.openRatingModal.emit(this.item)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=h({type:s,selectors:[["app-favorites-card"]],inputs:{item:"item",type:"type"},outputs:{rated:"rated",favoriteChanged:"favoriteChanged",watchlistChanged:"watchlistChanged",removed:"removed",openRatingModal:"openRatingModal"},decls:32,vars:17,consts:[[1,"card-container"],[1,"poster"],[1,"poster-img",3,"src","alt"],[1,"details"],[1,"rating-badge"],[1,"title"],[1,"release-date"],[1,"fa-solid","fa-calendar"],[1,"overview"],[1,"actions-container"],[1,"rating-button",3,"click"],[1,"action-badge"],[1,"favorite-button",3,"click"],[1,"fa",3,"ngClass"],[1,"add-to-watchlist-btn",3,"click"],[1,"remove-button",3,"click"],[1,"fa-solid","fa-trash"]],template:function(e,t){if(e&1&&(r(0,"div",0)(1,"div",1),b(2,"img",2),o(),r(3,"div",3)(4,"div",4),l(5),U(6,"number"),o(),r(7,"h5",5),l(8),o(),r(9,"p",6),b(10,"i",7),l(11),U(12,"date"),o(),r(13,"p",8),l(14),o(),r(15,"div",9)(16,"button",10),m("click",function(){return t.openRatingModalHandler()}),r(17,"div",11),l(18),o(),l(19," Your Rating "),o(),r(20,"button",12),m("click",function(){return t.toggleFavorite()}),r(21,"div",11),b(22,"i",13),o(),l(23),o(),r(24,"button",14),m("click",function(){return t.toggleWatchlist()}),r(25,"div",11),b(26,"i",13),o(),l(27),o(),r(28,"button",15),m("click",function(){return t.remove()}),r(29,"div",11),b(30,"i",16),o(),l(31," Remove "),o()()()()),e&2){let i;c(2),d("src",t.poster,D)("alt",t.title),c(3),f(" ",t.item.vote_average>0?L(6,11,t.item.vote_average,"1.1-1"):"NR"," "),c(3),w(t.title),c(3),f("",L(12,14,t.item.release_date||t.item.first_air_date,"longDate")," (GR) "),c(3),w(t.overview),c(4),f(" ",(i=t.item.rated==null?null:t.item.rated.value)!==null&&i!==void 0?i:"N/A"," "),c(4),d("ngClass",t.item.favorite?"fa-heart":"fa-heart-o"),c(),f(" ",t.item.favorite?"Remove from favorites":"Add to favorites"," "),c(3),d("ngClass",t.item.watchlist?"fa-minus":"fa-plus"),c(),f(" ",t.item.watchlist?"Remove from watchlist":"Add to watchlist"," ")}},dependencies:[C,$,G,H],styles:[".card-container[_ngcontent-%COMP%]{display:flex;background-color:#fff;color:#000;border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 4px 12px #00000014;max-width:1300px;flex-wrap:wrap;margin:auto;margin-bottom:1rem}.poster-img[_ngcontent-%COMP%]{width:120px;height:auto;border-radius:12px;object-fit:cover}.fa-calendar[_ngcontent-%COMP%]{margin-right:5px}.details[_ngcontent-%COMP%]{display:flex;flex:1;margin-left:1.5rem;flex-direction:column}.title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem}.release-date[_ngcontent-%COMP%]{font-size:1rem;color:#666;margin-bottom:.5rem}.overview[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5;margin-bottom:1rem;color:#333}.actions-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background-color:#fff;border:none;color:#000}.action-badge[_ngcontent-%COMP%]{width:45px;height:45px;background-color:#e9e9e9;color:#333;font-size:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 3px #0003}.rating-button[_ngcontent-%COMP%]   .action-badge[_ngcontent-%COMP%]{background-color:#f1b903;color:#000;font-weight:700}.favorite-button[_ngcontent-%COMP%]   .action-badge[_ngcontent-%COMP%]{color:red}.remove-button[_ngcontent-%COMP%]   .action-badge[_ngcontent-%COMP%]{color:#c00}.rating-badge[_ngcontent-%COMP%]{background-color:#354245d9;color:#f1b903;border-radius:50%;width:45px;height:45px;font-size:22px;font-weight:700;display:flex;justify-content:center;align-items:center;box-shadow:0 2px 6px #0000004d;margin-bottom:10px}.actions-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover   .action-badge[_ngcontent-%COMP%]{transform:scale(1.1)}.rating-button[_ngcontent-%COMP%]:hover   .action-badge[_ngcontent-%COMP%]{background-color:#f1b903}.favorite-button[_ngcontent-%COMP%]:hover   .action-badge[_ngcontent-%COMP%]{background-color:#ffe6e6}.add-to-watchlist-btn[_ngcontent-%COMP%]:hover   .action-badge[_ngcontent-%COMP%]{background-color:#e6f4ff}.remove-button[_ngcontent-%COMP%]:hover   .action-badge[_ngcontent-%COMP%]{background-color:#ffe5e5}"]})};var ie=()=>[1,2,3,4,5,6,7,8,9,10];function oe(s,n){if(s&1){let e=M();r(0,"i",7),m("click",function(){let i=g(e).$implicit,a=p();return _(a.setRating(i))}),o()}if(s&2){let e=n.$implicit,t=p();N("filled",e<=t.selectedRating)}}var I=class s{item;rate=new u;close=new u;selectedRating=0;setRating(n){this.selectedRating=n}submitRating(){this.selectedRating>0&&(this.rate.emit(this.selectedRating),this.close.emit())}cancel(){this.close.emit()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=h({type:s,selectors:[["app-star-rating-modal"]],inputs:{item:"item"},outputs:{rate:"rate",close:"close"},decls:11,vars:3,consts:[[1,"modal-overlay",3,"click"],[1,"modal-container"],[1,"stars"],["class","fa-star fa",3,"filled","click",4,"ngFor","ngForOf"],[1,"modal-actions"],[1,"submit-btn",3,"click"],[1,"cancel-btn",3,"click"],[1,"fa-star","fa",3,"click"]],template:function(e,t){e&1&&(r(0,"div",0),m("click",function(){return t.cancel()}),o(),r(1,"div",1)(2,"h3"),l(3),o(),r(4,"div",2),y(5,oe,1,2,"i",3),o(),r(6,"div",4)(7,"button",5),m("click",function(){return t.submitRating()}),l(8,"Submit"),o(),r(9,"button",6),m("click",function(){return t.cancel()}),l(10,"Cancel"),o()()()),e&2&&(c(3),f("Rate: ",t.item.title||t.item.name,""),c(2),d("ngForOf",W(2,ie)))},dependencies:[C,R],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;z-index:999}.modal-container[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;padding:2rem;text-align:center;z-index:1000;width:400px}.stars[_ngcontent-%COMP%]{margin:1rem 0}.fa-star[_ngcontent-%COMP%]{font-size:20px;color:#ccc;cursor:pointer;margin:0 2px}.fa-star.filled[_ngcontent-%COMP%]{color:gold}.modal-actions[_ngcontent-%COMP%]{margin-top:1rem;display:flex;justify-content:space-around}.submit-btn[_ngcontent-%COMP%], .cancel-btn[_ngcontent-%COMP%]{padding:.4rem 1.2rem;border:none;border-radius:8px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}"]})};function re(s,n){if(s&1){let e=M();r(0,"app-favorites-card",6),m("rated",function(i){g(e);let a=p(2);return _(a.onRate(i))})("favoriteChanged",function(i){g(e);let a=p(2);return _(a.onToggleFavorite(i))})("watchlistChanged",function(i){g(e);let a=p(2);return _(a.onToggleWatchlist(i))})("removed",function(i){g(e);let a=p(2);return _(a.onRemove(i))})("openRatingModal",function(i){g(e);let a=p(2);return _(a.ratingModal.set(i))}),o()}if(s&2){let e=n.$implicit;d("item",e)("type","favorites")}}function ae(s,n){if(s&1&&(F(0),y(1,re,1,2,"app-favorites-card",5),V()),s&2){let e=p();c(),d("ngForOf",e.results())}}function se(s,n){s&1&&(r(0,"p",7),l(1,"No results found."),o())}function ce(s,n){if(s&1){let e=M();F(0),r(1,"app-star-rating-modal",8),m("rate",function(i){let a=g(e).ngIf,S=p();return _(S.onRate({item:a,rating:i}))})("close",function(){g(e);let i=p();return _(i.ratingModal.set(null))}),o(),V()}if(s&2){let e=n.ngIf;c(),d("item",e)}}var Z=class s{constructor(n,e,t){this.tmdbService=n;this.route=e;this.authService=t}listType=x("favorites");title=x("");results=x([]);ratingModal=x(null);ngOnInit(){this.route.paramMap.subscribe(n=>{let e=n.get("type");if(!n.get("username")||!e)return;this.listType.set(e),this.title.set(`My ${e.charAt(0).toUpperCase()+e.slice(1)}`);let i=localStorage.getItem("session_id"),a=localStorage.getItem("user_id");if(!i||!a)return;let S={favorites:this.tmdbService.getFavorites.bind(this.tmdbService),watchlist:this.tmdbService.getUserWatchlist.bind(this.tmdbService),ratings:this.tmdbService.getUserRatings.bind(this.tmdbService)}[e];A([S(a,i,"movie"),S(a,i,"tv")]).subscribe(([ee,te])=>{let ne=[...(ee.results||[]).map(v=>{let k=v.rating?{value:v.rating}:null;return E(T({},v),{media_type:"movie",rated:k})}),...(te.results||[]).map(v=>{let k=v.rating?{value:v.rating}:null;return E(T({},v),{media_type:"tv",rated:k})})];this.results.set(ne)})})}onRate(n){let{item:e,rating:t}=n,i=this.authService.getSessionId();if(!i||!e?.id)return;let a=e.media_type||(e.title?"movie":"tv");e.rated={value:t},this.tmdbService.rateMovieorSeries(a,e.id,i,t).subscribe(()=>{})}onToggleFavorite(n){let e=this.authService.getSessionId(),t=this.authService.getAccountId(),i=n.media_type||(n.title?"movie":"tv"),a=!n.favorite;!e||!t||this.tmdbService.toggleFavorite(i,t,n.id,a,e).subscribe(()=>{n.favorite=a})}onToggleWatchlist(n){let e=this.authService.getSessionId(),t=this.authService.getAccountId(),i=n.media_type||(n.title?"movie":"tv"),a=!n.watchlist;!e||!t||this.tmdbService.toggleWatchlist(i,t,n.id,a,e).subscribe(()=>{n.watchlist=a})}removeLocally(n){let t=this.results().filter(i=>i.id!==n.id);this.results.set(t)}onRemove(n){let e=this.authService.getSessionId(),t=this.authService.getAccountId(),i=n.media_type||(n.title?"movie":"tv");if(!(!e||!t)){switch(this.listType()){case"favorites":this.tmdbService.toggleFavorite(i,t,n.id,!1,e).subscribe(()=>this.removeLocally(n));break;case"watchlist":this.tmdbService.toggleWatchlist(i,t,n.id,!1,e).subscribe(()=>this.removeLocally(n));break;case"ratings":this.tmdbService.removeRating(i,n.id,e).subscribe(()=>this.removeLocally(n));break}console.log("Removing from ratings:",n)}}openRatingModal(n){this.ratingModal.set(n)}static \u0275fac=function(e){return new(e||s)(O(q),O(J),O(Y))};static \u0275cmp=h({type:s,selectors:[["app-user-list"]],decls:8,vars:4,consts:[["noResults",""],[1,"user-list-container"],[1,"title"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[3,"item","type","rated","favoriteChanged","watchlistChanged","removed","openRatingModal",4,"ngFor","ngForOf"],[3,"rated","favoriteChanged","watchlistChanged","removed","openRatingModal","item","type"],[1,"no-results"],[3,"rate","close","item"]],template:function(e,t){if(e&1&&(r(0,"div",1)(1,"div",2)(2,"h2"),l(3),o()(),y(4,ae,2,1,"ng-container",3)(5,se,2,0,"ng-template",null,0,j)(7,ce,2,1,"ng-container",4),o()),e&2){let i=z(6);c(3),w(t.title()),c(),d("ngIf",t.results().length>0)("ngIfElse",i),c(3),d("ngIf",t.ratingModal())}},dependencies:[C,R,B,P,I],styles:[".user-list-container[_ngcontent-%COMP%]{min-height:calc(100vh - 100px);background-color:#fff;padding:2rem}.title[_ngcontent-%COMP%], .no-results[_ngcontent-%COMP%]{max-width:1300px;margin:auto}"]})};export{Z as UserListComponent};
