import{l as ee}from"./chunk-HN6EORLH.js";import{a as ie}from"./chunk-6BKZ3TYD.js";import{a as te}from"./chunk-VXYLYJCB.js";import{$ as p,$a as Q,Aa as _,Ba as m,Ca as V,Da as B,E as h,Ea as U,F as C,Fa as L,Ia as G,Ka as J,L as g,La as D,N as w,Na as R,P as a,R as M,Sa as F,T as I,Ta as $,Wa as q,Xa as H,Y as u,Ya as S,_a as K,a as k,b as W,bb as P,da as z,fa as j,ga as N,ha as s,ia as r,ib as X,ja as y,kb as Y,lb as Z,na as A,ob as O,pa as x,qa as d,za as l}from"./chunk-P4JO3VSF.js";function le(n,i){if(n&1&&(s(0,"p",5),l(1),r()),n&2){let e=d();a(),V(" ",e.castMember.total_episode_count," episode ",e.castMember.total_episode_count>1?"s":""," ")}}var T=class n{constructor(i){this.router=i}castMember;showEpisodeCount=!1;goToCastDetails(i){this.router.navigate(["/person",i])}static \u0275fac=function(e){return new(e||n)(M(Y))};static \u0275cmp=I({type:n,selectors:[["app-cast-card"]],inputs:{castMember:"castMember",showEpisodeCount:"showEpisodeCount"},decls:8,vars:5,consts:[[1,"card-wrapper"],[1,"profile",3,"click","src","alt"],[1,"person-details"],[1,"character"],["class","episodes",4,"ngIf"],[1,"episodes"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"img",1),x("click",function(){return t.goToCastDetails(t.castMember.id)}),r(),s(2,"div",2)(3,"h3"),l(4),r(),s(5,"p",3),l(6),r(),u(7,le,2,2,"p",4),r()()),e&2&&(a(),p("src","https://image.tmdb.org/t/p/w185"+t.castMember.profile_path,w)("alt",t.castMember.name),a(3),_(t.castMember.name),a(2),_(t.castMember.character),a(),p("ngIf",t.showEpisodeCount&&t.castMember.total_episode_count))},dependencies:[P,S,O],styles:[".card-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:150px;align-items:center;cursor:pointer;color:#fff;text-align:center}.profile[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:8px}.person-details[_ngcontent-%COMP%]{margin-top:10px}.person-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.character[_ngcontent-%COMP%], .episodes[_ngcontent-%COMP%]{font-size:15px;color:#cacaca}"]})};var pe=(n,i,e)=>({"bi-star-fill":n,"bi-star-half":i,"bi-star":e}),de=n=>["/person",n],me=(n,i)=>i.id;function ge(n,i){if(n&1&&(s(0,"span",22),l(1),r()),n&2){let e=d().ngIf;a(),m(" ",e.runtime," min ")}}function fe(n,i){if(n&1&&y(0,"i",23),n&2){let e=i.fill;p("ngClass",J(1,pe,e===100,e>0&&e<100,e===0))}}function ue(n,i){if(n&1&&(s(0,"div",26)(1,"a",27),l(2),r(),s(3,"span",28),l(4),r()()),n&2){let e=i.$implicit;a(),p("routerLink",G(3,de,e.id)),a(),m(" ",e.name," "),a(2),m(" ",e.roles.join(", "),"")}}function _e(n,i){if(n&1&&(s(0,"div",24),u(1,ue,5,5,"div",25),r()),n&2){let e=d(2);a(),p("ngForOf",e.groupCrewByPerson())}}function ve(n,i){if(n&1){let e=A();s(0,"div",2)(1,"div",3),y(2,"img",4),r(),s(3,"div",5)(4,"h2",6),l(5),s(6,"span",7),l(7),r()(),s(8,"div",8)(9,"span",9),l(10),D(11,"date"),r(),s(12,"span",10)(13,"span",11),l(14,"\u2022"),r(),l(15),r(),s(16,"span",11),l(17,"\u2022"),r(),u(18,ge,2,1,"span",12),r(),s(19,"div",13),l(20),D(21,"number"),r(),s(22,"p",14),l(23),r(),s(24,"div",15)(25,"button",16),x("click",function(){h(e);let o=d();return C(o.toggleFavorite())}),s(26,"span",17),l(27),r(),l(28),r(),s(29,"button",16),x("click",function(){h(e);let o=d();return C(o.toggleWatchlist())}),s(30,"span",17),l(31),r(),l(32),r()(),s(33,"div",18)(34,"ngb-rating",19),L("rateChange",function(o){h(e);let c=d();return U(c.starRating,o)||(c.starRating=o),C(o)}),x("rateChange",function(o){h(e);let c=d();return C(c.movieRate(o))}),u(35,fe,1,5,"ng-template"),r(),s(36,"span",20),l(37),r()(),u(38,_e,2,1,"div",21),r()()}if(n&2){let e=i.ngIf,t=d();a(2),p("src","https://image.tmdb.org/t/p/w500"+e.poster_path,w),a(3),m(" ",e.title||e.name," "),a(2),m("(",(e.release_date||e.first_air_date)==null?null:(e.release_date||e.first_air_date).slice(0,4),")"),a(3),m(" ",R(11,17,e.release_date||e.first_air_date,"MM/dd/yyyy")," (GR) "),a(5),m(" ",t.genres()," "),a(3),p("ngIf",e.runtime),a(2),m(" ",e.vote_average>0?R(21,20,e.vote_average,"1.1-1"):"NR"," "),a(3),_(e.overview),a(4),_(t.isFavourite()?"\u2605":"\u2606"),a(),m(" ",t.isFavourite()?"In Favorites":"Add to Favorites"," "),a(3),_(t.isWatchlisted()?"\u2714":"+"),a(),m(" ",t.isWatchlisted()?"In Watchlist":"Add to Watchlist"," "),a(2),B("rate",t.starRating),p("max",10)("readonly",!1),a(3),m("(",t.userRating()||"Not Rated",")"),a(),p("ngIf",t.groupCrewByPerson().length)}}function xe(n,i){if(n&1&&y(0,"app-cast-card",32),n&2){let e=i.$implicit,t=d(2);p("castMember",e)("showEpisodeCount",t.mediaType()==="tv")}}function be(n,i){if(n&1&&(s(0,"div",29)(1,"h3",30),l(2,"Top Billed Cast"),r(),s(3,"div",31),j(4,xe,1,2,"app-cast-card",32,me),r()()),n&2){let e=d();a(4),N(e.cast().slice(0,20))}}function he(n,i){n&1&&y(0,"app-spinner")}var ne=class n{constructor(i,e){this.route=i;this.tmdbService=e;let t=this.route.snapshot.routeConfig?.path?.startsWith("tv")?"tv":"movie",o=this.route.snapshot.paramMap.get("id");this.mediaType.set(t),this.id.set(o?+o:null),$(()=>{let c=this.id(),f=this.mediaType();c&&f&&(this.loading.set(!0),this.tmdbService.getMovieDetails(f,c).subscribe(E=>{this.details.set(E);let b=[];if(f==="tv"&&E.created_by?.length){let v=E.created_by.map(oe=>W(k({},oe),{job:"Creator"}));b=[...b,...v]}this.tmdbService.getCredits(f,c).subscribe(v=>{v.crew?.length&&(b=[...b,...v.crew]),this.crew.set(b),v.cast?.length&&this.cast.set(v.cast),this.loading.set(!1)})}))})}mediaType=g("movie");id=g(null);details=g(null);crew=g([]);cast=g([]);isFavourite=g(!1);isWatchlisted=g(!1);userRating=g(null);starRating=g(0);loading=g(!0);ngOnInit(){this.loadUserActions()}setInitialRating(i){this.starRating.set(i)}loadUserActions(){let i=localStorage.getItem("user_id"),e=localStorage.getItem("session_id"),t=this.id();!i||!e||!t||(this.tmdbService.getFavorites(i,e,this.mediaType()).subscribe(o=>{let c=o.results.find(f=>f.id===t);this.isFavourite.set(!!c)}),this.tmdbService.getUserWatchlist(i,e,this.mediaType()).subscribe(o=>{let c=o.results.find(f=>f.id===t);this.isWatchlisted.set(!!c)}),this.tmdbService.getUserRatings(i,e,this.mediaType()).subscribe(o=>{let c=o.results.find(f=>f.id===t);console.log("Found rating:",c),c&&(this.starRating.set(c.rating),this.userRating.set(c.rating),this.setInitialRating(c.rating))}))}toggleFavorite(){let i=localStorage.getItem("user_id"),e=localStorage.getItem("session_id"),t=this.id(),o=this.mediaType();if(!i||!e||!t)return;let c=!this.isFavourite();this.tmdbService.markAsFavorite(i,e,{media_type:o,media_id:t,favorite:c}).subscribe(()=>{this.isFavourite.set(c)})}toggleWatchlist(){let i=localStorage.getItem("user_id"),e=localStorage.getItem("session_id"),t=this.id(),o=this.mediaType();if(console.log("Toggle Watchlist:",{accountId:i,sessionId:e,id:t,media:o}),!i||!e||!t)return;let c=!this.isWatchlisted();this.tmdbService.addToWatchlist(i,e,{media_type:o,media_id:t,watchlist:c}).subscribe(()=>{this.isWatchlisted.set(c)})}movieRate(i){let e=localStorage.getItem("session_id"),t=this.id(),o=this.mediaType();!e||!t||this.tmdbService.rateMovieorSeries(o,t,e,i).subscribe(()=>{this.userRating.set(i),this.starRating.set(i)})}genres=F(()=>this.details()?.genres?.map(e=>e.name).join(", ")||"");groupCrewByPerson=F(()=>{let i=new Map,e=["Director","Screenplay","Writer","Story","Creator","Writing","Directing"];for(let t of this.crew()){if(!e.includes(t.job))continue;let o=i.get(t.id);o?o.roles.includes(t.job)||o.roles.push(t.job):i.set(t.id,{id:t.id,name:t.name,roles:[t.job]})}return Array.from(i.values())});static \u0275fac=function(e){return new(e||n)(M(X),M(te))};static \u0275cmp=I({type:n,selectors:[["app-movie-details"]],decls:3,vars:3,consts:[["class","details-container",4,"ngIf"],["class","cast-container",4,"ngIf"],[1,"details-container"],[1,"poster-wrapper"],[3,"src"],[1,"info-wrapper"],[1,"title"],[1,"year"],[1,"more-info"],[1,"release-date"],[1,"genres"],[1,"bullet"],["class","runtime",4,"ngIf"],[1,"rating-badge"],[1,"overview"],[1,"actions-container"],[1,"action-button",3,"click"],[1,"icon"],[1,"rating-container","custom-ngb-rating"],[3,"rateChange","rate","max","readonly"],[1,"current-rating"],["class","crew-info",4,"ngIf"],[1,"runtime"],[1,"bi",3,"ngClass"],[1,"crew-info"],["class","crew-type",4,"ngFor","ngForOf"],[1,"crew-type"],[1,"person-link",3,"routerLink"],[1,"job"],[1,"cast-container"],[1,"section-title"],[1,"cast-grid"],[3,"castMember","showEpisodeCount"]],template:function(e,t){e&1&&u(0,ve,39,23,"div",0)(1,be,6,0,"div",1)(2,he,1,0,"app-spinner"),e&2&&(p("ngIf",t.details()),a(),p("ngIf",t.cast().length),a(),z(t.loading()?2:-1))},dependencies:[P,q,H,S,Q,K,O,Z,T,ee,ie],styles:[".details-container[_ngcontent-%COMP%]{display:flex;color:#fff;gap:15px;padding:15px;background-color:#0d083aca}.poster-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px;border-radius:12px;object-fit:cover;margin-left:100px}.info-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex-direction:column}.title[_ngcontent-%COMP%]{font-size:30px;font-weight:700}.title[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{font-weight:400;font-size:25px;color:#ccc;margin-left:5px}.more-info[_ngcontent-%COMP%]{display:flex;font-size:15px;gap:8px;color:#bbb;margin-bottom:15px}.bullet[_ngcontent-%COMP%]{font-size:15px;padding:0 5px;color:#c7c7c7}.rating-badge[_ngcontent-%COMP%]{background-color:#354245d9;color:#f1b903;border-radius:50%;width:55px;height:55px;font-size:22px;font-weight:700;display:flex;justify-content:center;align-items:center;box-shadow:0 2px 6px #0000004d;margin-bottom:10px}.overview[_ngcontent-%COMP%]{font-size:15px;line-height:1.6;color:#ddd}.crew-info[_ngcontent-%COMP%]{margin-top:20px;font-size:16px;color:#ccc}.crew-type[_ngcontent-%COMP%]{margin-bottom:8px}a.person-link[_ngcontent-%COMP%]{color:#42b6d6;font-weight:500;text-decoration:none}a.person-link[_ngcontent-%COMP%]:hover{color:#61c9e6}.job[_ngcontent-%COMP%]{font-style:italic;margin-left:4px}.cast-container[_ngcontent-%COMP%]{margin-top:30px;margin-left:110px;max-width:1200px;flex-wrap:wrap}.section-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:15px;color:#fff}.cast-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.actions-container[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem}.action-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background-color:#28283c99;border:1px solid #555;border-radius:8px;padding:.5rem 1rem;color:#ddd;font-weight:500;font-size:1rem}.action-button[_ngcontent-%COMP%]:hover{background-color:#505078cc;color:#fff;transform:scale(1.02)}.icon[_ngcontent-%COMP%]{font-size:1.2rem;color:#f1b903}.rating-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-top:20px;flex-wrap:wrap}.rating-label[_ngcontent-%COMP%]{font-weight:600;color:#ccc}.current-rating[_ngcontent-%COMP%]{font-size:.95rem;color:#bbb}.custom-ngb-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:23px;color:#f1b903}.custom-ngb-rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{transform:scale(1.2);color:gold}.current-rating[_ngcontent-%COMP%]{font-size:20px;font-weight:500;color:snow}"]})};export{ne as MovieDetailsComponent};
